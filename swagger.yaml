openapi: 3.0.3
info:
  title: Weather Analytics API
  version: 1.0.0
  description: |
    Secure Weather Analytics API that computes a Comfort Index for cities.
    Only authenticated users can access the dashboard. Caching implemented.

servers:
  - url: http://localhost:5000/api
    description: Local dev server

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    WeatherCity:
      type: object
      properties:
        city:
          type: string
          example: Colombo
        temperature:
          type: number
          example: 33.0
        weather:
          type: string
          example: Clouds
        comfortScore:
          type: integer
          example: 82
        rank:
          type: integer
          example: 1

paths:
  /weather/dashboard:
    get:
      summary: Get the weather dashboard with Comfort Index
      description: Returns weather data for predefined cities with computed Comfort Index scores and ranking.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Success, list of cities with Comfort Index
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WeatherCity'
        '401':
          description: Unauthorized, invalid or missing JWT

  /cache/status:
    get:
      summary: Get cache status
      description: Returns keys and stats from server-side cache (HIT/MISS info)
      responses:
        '200':
          description: Cache information
          content:
            application/json:
              schema:
                type: object
                properties:
                  keys:
                    type: array
                    items:
                      type: string
                    example: ["/weather/dashboard"]
                  stats:
                    type: object
                    properties:
                      hits:
                        type: integer
                        example: 2
                      misses:
                        type: integer
                        example: 1
                      keys:
                        type: integer
                        example: 1
                      ksize:
                        type: integer
                        example: 100
                      vsize:
                        type: integer
                        example: 2000
